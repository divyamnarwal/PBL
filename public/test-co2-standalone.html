<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CO2 Monitor Test - Standalone</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }
    
    .status-indicator.connected {
      background-color: #10b981;
      animation: pulse-green 2s infinite;
    }
    
    .status-indicator.connecting {
      background-color: #fbbf24;
      animation: pulse-yellow 1s infinite;
    }
    
    .status-indicator.disconnected {
      background-color: #ef4444;
    }
    
    @keyframes pulse-green {
      0%, 100% {
        opacity: 1;
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
      }
      50% {
        opacity: 0.8;
        box-shadow: 0 0 0 6px rgba(16, 185, 129, 0);
      }
    }
    
    @keyframes pulse-yellow {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <div class="max-w-7xl mx-auto">
    <h1 class="text-4xl font-bold text-white text-center mb-8">ðŸŒ± Real-Time CO2 Monitor (Test Mode)</h1>
    
    <!-- Real-Time CO2 Monitoring Section -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-2xl">
      <!-- Section Header -->
      <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100">
            ðŸŒ± Live COâ‚‚ Monitoring
          </h2>
          <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
            Real-time sensor data simulation
          </p>
        </div>
        <!-- Connection Status -->
        <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-700">
          <span id="status-indicator" class="status-indicator connected"></span>
          <span id="status-text" class="text-sm font-medium text-gray-700 dark:text-gray-300">Simulation Active</span>
        </div>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <!-- Current CO2 Card -->
        <div class="col-span-1 md:col-span-2 bg-gradient-to-br from-green-50 to-blue-50 dark:from-gray-700 dark:to-gray-600 rounded-xl p-6 border-2 border-green-200 dark:border-green-700">
          <div class="text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Current COâ‚‚ Level</div>
          <div class="flex items-baseline gap-3">
            <div id="co2-value" class="text-5xl font-bold text-green-600 dark:text-green-400">
              --
            </div>
            <div class="text-2xl font-medium text-gray-500 dark:text-gray-400">ppm</div>
          </div>
          <div class="mt-3 flex items-center justify-between">
            <div id="co2-quality" class="text-lg font-semibold">
              ðŸŸ¡ Starting...
            </div>
            <div class="text-xs text-gray-500 dark:text-gray-400" id="last-update">
              Just now
            </div>
          </div>
        </div>

        <!-- Min Value Card -->
        <div class="bg-white dark:bg-gray-700 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-600">
          <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Today's Minimum</div>
          <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">
            <span id="min-value">--</span> <span class="text-sm font-normal">ppm</span>
          </div>
          <div class="mt-1 text-xs text-gray-500 dark:text-gray-400">Lowest recorded</div>
        </div>

        <!-- Max Value Card -->
        <div class="bg-white dark:bg-gray-700 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-600">
          <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Today's Maximum</div>
          <div class="text-2xl font-bold text-red-600 dark:text-red-400">
            <span id="max-value">--</span> <span class="text-sm font-normal">ppm</span>
          </div>
          <div class="mt-1 text-xs text-gray-500 dark:text-gray-400">Highest recorded</div>
        </div>
      </div>

      <!-- Chart and Info Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Trend Chart -->
        <div class="lg:col-span-2 bg-white dark:bg-gray-700 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-600">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">COâ‚‚ Trend</h3>
            <div class="text-xs text-gray-500 dark:text-gray-400">Last 50 readings</div>
          </div>
          <div class="relative" style="height: 300px;">
            <canvas id="co2-chart"></canvas>
          </div>
        </div>

        <!-- Statistics and Sensor Info -->
        <div class="space-y-4">
          <!-- Average Card -->
          <div class="bg-white dark:bg-gray-700 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-600">
            <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Session Average</div>
            <div class="text-3xl font-bold text-purple-600 dark:text-purple-400">
              <span id="avg-value">--</span> <span class="text-sm font-normal">ppm</span>
            </div>
            <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">Mean COâ‚‚ level</div>
          </div>

          <!-- Sensor Info Card -->
          <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
            <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-3">Sensor Information</div>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600 dark:text-gray-300">Type:</span>
                <span id="sensor-type" class="font-medium text-gray-800 dark:text-gray-100">MH-Z19</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 dark:text-gray-300">Status:</span>
                <span id="sensor-status" class="font-medium text-green-600">âœ“ Active</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 dark:text-gray-300">Mode:</span>
                <span class="font-medium text-gray-800 dark:text-gray-100">Simulated</span>
              </div>
            </div>
          </div>

          <!-- CO2 Level Guide -->
          <div class="bg-white dark:bg-gray-700 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-600">
            <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-3">COâ‚‚ Level Guide</div>
            <div class="space-y-2 text-xs">
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-green-500"></span>
                <span class="text-gray-600 dark:text-gray-300">400-600: Excellent</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                <span class="text-gray-600 dark:text-gray-300">600-1000: Good</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-orange-500"></span>
                <span class="text-gray-600 dark:text-gray-300">1000-1500: Moderate</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-red-500"></span>
                <span class="text-gray-600 dark:text-gray-300">1500+: Poor</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Success Message -->
      <div class="mt-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
        <h3 class="font-semibold text-green-900 dark:text-green-100 mb-2">âœ… Simulation Running!</h3>
        <p class="text-sm text-green-800 dark:text-green-200">
          Watch the dashboard update in real-time with simulated COâ‚‚ data. This demonstrates how the live monitoring works!
        </p>
      </div>
    </div>
  </div>

<script>
// Inline Real-Time Monitor (no module imports needed)
class SimpleMonitor {
  constructor() {
    this.chart = null;
    this.dataBuffer = [];
    this.maxBufferSize = 100;
    this.statistics = {
      min: Infinity,
      max: -Infinity,
      avg: 0,
      count: 0
    };
    
    this.thresholds = {
      excellent: { max: 600, color: '#10b981', label: 'Excellent', emoji: 'ðŸŸ¢' },
      good: { max: 1000, color: '#fbbf24', label: 'Good', emoji: 'ðŸŸ¡' },
      moderate: { max: 1500, color: '#f97316', label: 'Moderate', emoji: 'ðŸŸ ' },
      poor: { max: 2000, color: '#ef4444', label: 'Poor', emoji: 'ðŸ”´' },
      hazardous: { max: 5000, color: '#991b1b', label: 'Hazardous', emoji: 'âš«' }
    };
  }

  init() {
    this.initChart();
    console.log('âœ… Monitor initialized!');
  }

  initChart() {
    const ctx = document.getElementById('co2-chart').getContext('2d');
    this.chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'COâ‚‚ Level (ppm)',
          data: [],
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          borderWidth: 2,
          tension: 0.4,
          fill: true,
          pointRadius: 3,
          pointHoverRadius: 5
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: true, position: 'top' },
          tooltip: {
            enabled: true,
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            callbacks: {
              label: (context) => `COâ‚‚: ${context.parsed.y} ppm`
            }
          }
        },
        scales: {
          x: {
            display: true,
            title: { display: true, text: 'Time' },
            grid: { display: false }
          },
          y: {
            display: true,
            title: { display: true, text: 'COâ‚‚ (ppm)' },
            beginAtZero: false,
            suggestedMin: 400,
            suggestedMax: 1500,
            grid: { color: 'rgba(0, 0, 0, 0.05)' }
          }
        },
        animation: { duration: 750 }
      }
    });
  }

  handleData(data) {
    this.dataBuffer.push(data);
    if (this.dataBuffer.length > this.maxBufferSize) {
      this.dataBuffer.shift();
    }

    this.updateStatistics(data.co2);
    this.updateCurrentReading(data);
    this.updateChart(data);
    this.updateStatisticsDisplay();
  }

  updateCurrentReading(data) {
    document.getElementById('co2-value').textContent = data.co2;
    
    const quality = this.getQualityLevel(data.co2);
    const qualityEl = document.getElementById('co2-quality');
    qualityEl.textContent = `${quality.emoji} ${quality.label}`;
    qualityEl.style.color = quality.color;
    
    document.getElementById('last-update').textContent = 'Just now';
    document.getElementById('sensor-type').textContent = data.sensor || 'MH-Z19';
  }

  updateChart(data) {
    if (!this.chart) return;
    
    const timeLabel = new Date(data.timestamp).toLocaleTimeString('en-US', { 
      hour: '2-digit', 
      minute: '2-digit',
      second: '2-digit'
    });

    this.chart.data.labels.push(timeLabel);
    this.chart.data.datasets[0].data.push(data.co2);

    if (this.chart.data.labels.length > 50) {
      this.chart.data.labels.shift();
      this.chart.data.datasets[0].data.shift();
    }

    const quality = this.getQualityLevel(data.co2);
    this.chart.data.datasets[0].borderColor = quality.color;
    this.chart.data.datasets[0].backgroundColor = quality.color + '20';

    this.chart.update('none');
  }

  updateStatistics(co2Value) {
    this.statistics.count++;
    this.statistics.min = Math.min(this.statistics.min, co2Value);
    this.statistics.max = Math.max(this.statistics.max, co2Value);
    this.statistics.avg = ((this.statistics.avg * (this.statistics.count - 1)) + co2Value) / this.statistics.count;
  }

  updateStatisticsDisplay() {
    document.getElementById('min-value').textContent = Math.round(this.statistics.min);
    document.getElementById('max-value').textContent = Math.round(this.statistics.max);
    document.getElementById('avg-value').textContent = Math.round(this.statistics.avg);
  }

  getQualityLevel(co2Value) {
    if (co2Value <= this.thresholds.excellent.max) return this.thresholds.excellent;
    if (co2Value <= this.thresholds.good.max) return this.thresholds.good;
    if (co2Value <= this.thresholds.moderate.max) return this.thresholds.moderate;
    if (co2Value <= this.thresholds.poor.max) return this.thresholds.poor;
    return this.thresholds.hazardous;
  }
}

// Initialize monitor
const monitor = new SimpleMonitor();
monitor.init();

// Start simulation automatically
console.log('ðŸš€ Starting CO2 simulation...');
let baseCO2 = 600;
let direction = 1;

setInterval(() => {
  const variation = Math.random() * 50 - 25;
  baseCO2 += (direction * 5) + variation;
  
  if (baseCO2 > 1200) direction = -1;
  if (baseCO2 < 500) direction = 1;
  
  const co2 = Math.max(400, Math.min(2000, Math.round(baseCO2)));
  
  const data = {
    co2: co2,
    status: 'OK',
    timestamp: new Date().toISOString(),
    sensor: 'MH-Z19 (Simulated)'
  };
  
  monitor.handleData(data);
  console.log('ðŸ“Š CO2:', data.co2, 'ppm');
}, 2000);

console.log('âœ… Dashboard is live! Watch it update every 2 seconds.');
</script>
</body>
</html>
